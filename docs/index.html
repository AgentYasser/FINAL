<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat with n8n</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
    h1 { text-align: center; }
    #log { border: 1px solid #ccc; padding: 16px; min-height: 300px; overflow-y: auto; }
    #log .system  { color: #666; }
    #log .user    { color: #00f; margin-top: 8px; }
    #log .assistant { color: #080; margin-top: 8px; }
    #input { width: 100%; box-sizing: border-box; padding: 8px; margin-top: 12px; }
    #send  { margin-top: 8px; }
  </style>
</head>
<body>

  <h1>Chat with n8n</h1>
  <div id="log"></div>
  <textarea id="input" placeholder="Say something…" rows="2"></textarea><br/>
  <button id="send">Send</button>

  <script>
    // ───────────────────────────────────────────────────────────
    // 1) Point this at your production webhook URL:
    const WEBHOOK_URL = 'https://doumani.app.n8n.cloud/webhook/webhook-test/52743fa3-c608-4f03-ba4e-c27bfe23e2a4';
    // ───────────────────────────────────────────────────────────

    // 2) Seed the conversation with your UAE-B2B Director system prompt:
    const history = [
      {
        role: 'system',
        content: `You are a GTM Director’s AI assistant specialized in the United Arab Emirates B2B market across all industries.
Your job is to deliver a comprehensive go-to-market execution plan—covering segmentation, positioning, messaging, channel strategy, tagging, and continuous optimization—without requiring any initial data from the user.
Always tailor your recommendations to UAE business customs, regulatory environment, and top B2B channels (e.g. LinkedIn, industry events, local partnerships).`
      }
    ];

    const logEl   = document.getElementById('log');
    const inputEl = document.getElementById('input');

    // Render every message in the log
    function render() {
      logEl.innerHTML = '';
      for (const msg of history) {
        const div = document.createElement('div');
        div.className = msg.role;
        div.innerHTML = `<strong>${msg.role}:</strong> ${msg.content}`;
        logEl.appendChild(div);
      }
      logEl.scrollTop = logEl.scrollHeight;
    }

    // Send user input to your n8n webhook & append the assistant’s reply
    async function send() {
      const text = inputEl.value.trim();
      if (!text) return;
      history.push({ role: 'user', content: text });
      render();
      inputEl.value = '';

      // POST entire history as JSON
      const resp = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ history })
      });

      // parse JSON array of { reply: "...", ... }
      const data = await resp.json();

      // handle each returned item
      for (const item of data) {
        // pick the right field
        const content = item.reply ?? item.message ?? JSON.stringify(item);
        history.push({ role: 'assistant', content });
      }
      render();
    }

    document.getElementById('send').addEventListener('click', send);

    // render initial system prompt
    render();
  </script>

</body>
</html>
