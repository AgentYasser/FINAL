<script>
  const form = document.querySelector('form');
  const input = document.querySelector('textarea');
  const chat = document.querySelector('#chat'); // assumes your chat log has id="chat"

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const userMessage = input.value.trim();
    if (!userMessage) return;

    // 1️⃣ Show user message
    const userLine = document.createElement('div');
    userLine.innerHTML = `<strong>You:</strong> ${userMessage}`;
    chat.appendChild(userLine);

    input.value = '';

    try {
      // 2️⃣ POST to your production webhook URL
      const res = await fetch(
        'https://doumani.app.n8n.cloud/webhook/webhook-test/52743fa3-c608-4f03-ba4e-c27bfe23e2a4',
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userMessage }),
        }
      );
      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      // 3️⃣ Parse JSON and show bot reply
      const { reply } = await res.json();
      const botLine = document.createElement('div');
      botLine.innerHTML = `<strong>Bot:</strong> ${reply}`;
      chat.appendChild(botLine);
    } catch (err) {
      const errLine = document.createElement('div');
      errLine.style.color = 'red';
      errLine.innerHTML = `<strong>Error:</strong> ${err.message}`;
      chat.appendChild(errLine);
    }

    // scroll to bottom
    chat.scrollTop = chat.scrollHeight;
  });
</script>
